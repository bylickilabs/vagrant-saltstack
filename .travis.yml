language: php
php:
- 5.5
before_script:
- sudo apt-get install apache2 libapache2-mod-fastcgi
- sudo cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv
  version-name)/etc/php-fpm.conf
- sudo a2enmod rewrite actions fastcgi alias
- echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
- ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
- sudo cp -f config/vhost-travis.conf /etc/apache2/sites-available/default
- sudo sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
- sudo service apache2 restart
- curl -s http://getcomposer.org/installer | php
- php composer.phar install --dev --no-interaction
script:
- ./vendor/bin/codecept run
after_success:
- git config --global user.email "builds@travis-ci.com"
- git config --global user.name "Travis CI"
- export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER
- git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
- git push --quiet https://$GITHUBKEY@github.com/dev-confidence/startup-startup $GIT_TAG
  > /dev/null 2>&1
notifications:
  slack: devconfidence:TLbWAofg2DzzxDo9uHcKveqk
branches:
  except:
  - /^build-[0-9a-z\-]*/
env:
  global:
    secure: HYP32uaNJm2TMTzQrpE2T8+xt5dT4gi1PasQJ/GLUeUuS79HlpiNmrgToyvRrG+5Oj3pBjsDl6rY+xbCH+SdlPP4MfFS07npdMheaa7ECgT1W0AWZY4BrwVi8w4qs/5ZfW/DoaiNbote5R7QcELUo3+G/ocBfAJEWn08PB1fKnE=
deploy:
  provider: heroku
  api_key:
    secure: jsUU01a6CiR8vNUevhR96Rdr48ht0OOnnBDZsftWJqYLxG/FX7rMuIoHSEI43WmPqzNHTJ5pSAEl70rOUQlVR9NfZtWCNhhIz0u0b6aylw1TzUlpfmjQ1Kipk/dfxImMQNylSWjiQF6wC3/yLsjp6ulCQoprO/quoMxhvWj2GD4=
  app: startup-startup
  on:
    repo: dev-confidence/startup-startup
